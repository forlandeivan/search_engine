# Требования к административной настройке режима обслуживания (MVP)

## 1) Где настраивается
- Раздел админки: `/admin/settings/maintenance`.
- Паттерн как у SMTP/индексации: отдельный settings‑page + API в `server/routes/admin/settings.routes.ts`.

## 2) Параметры (MVP)
- **scheduledStartAt**: ISO datetime (UTC) или `null`.
- **scheduledEndAt**: ISO datetime (UTC) или `null`.
- **forceEnabled**: boolean (экстренное включение).
- **messageTitle**: строка (заголовок).
- **messageBody**: строка (описание).
- **publicEta**: строка/ISO (время восстановления для UI).
- **updatedByAdminId**: ID администратора системы (для аудита).

> Статус (`off | scheduled | active`) вычисляется на сервере и не хранится отдельно.

## 3) Ограничения и валидации
- `scheduledStartAt < scheduledEndAt`, если оба заданы.
- Если задано расписание — оба поля обязательны.
- `messageTitle` и `messageBody` обязательны при активном режиме.
- Ограничение длины: `messageTitle` ≤ 120, `messageBody` ≤ 2000.

## 4) Логика включения/отключения
- **Экстренное включение:** `forceEnabled=true` → статус `active`.
- **Плановое включение:** `now ∈ [start, end]` → статус `active`.
- **Отключение:** `forceEnabled=false` и нет активного интервала → `off`.

## 5) Пересечение интервалов
- В системе поддерживается **один** интервал.
- Новое расписание полностью заменяет старое (с записью в аудит).

## 6) Сообщения пользователям
- Тексты используются в баннере и на экране обслуживания.
- Если текст не задан — дефолтный шаблон на сервере.

## 7) Логирование действий администратора
Отдельный журнал режима обслуживания:
- `eventType`: `enabled | disabled | schedule_updated | message_updated`.
- `actorAdminId`.
- `occurredAt`.
- `payload` (старые/новые значения).

Журнал доступен только в админке, есть фильтры по дате и типу.

## 8) Права доступа
- Управлять режимом может только `admin`.
- `/api/admin/*` должен быть защищён `requireAdmin`.
