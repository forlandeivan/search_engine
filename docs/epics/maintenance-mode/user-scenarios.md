# Пользовательские сценарии: режим обслуживания (MVP)

## Термины
- **Администратор системы** — глобальная роль `admin`.
- **Администратор воркспейса** — роль `owner` или `manager`.
- **Участник воркспейса** — роль `user`.

---

## Плановое обслуживание

### СЦ‑01. Баннер о плановом обслуживании
**Предусловия:**
- В админке задан интервал обслуживания (start/end в будущем).
- Пользователь авторизован.

**Шаги:**
1. Пользователь открывает `ChatPage` / `SkillsPage` / `KnowledgeBasePage`.
2. Клиент получает статус обслуживания.

**Ожидаемый результат:**
- Баннер отображается глобально (не зависит от страницы).
- Отображаются дата и время начала, ориентировочное окончание.

### СЦ‑02. Баннер на странице входа
**Предусловия:**
- Запланировано обслуживание.
- Пользователь не авторизован.

**Шаги:**
1. Пользователь открывает страницу входа (`/auth`).

**Ожидаемый результат:**
- Баннер отображается на странице входа/регистрации.

### СЦ‑03. Автоматическое включение обслуживания
**Предусловия:**
- Наступило время начала интервала.

**Шаги:**
1. Пользователь пытается открыть любой раздел.
2. Пользователь пытается выполнить любое действие (например, запросить список чатов).

**Ожидаемый результат:**
- Возвращается 503 + `errorCode=MAINTENANCE_MODE`.
- Показан экран обслуживания.

---

## Экстренное включение

### СЦ‑04. Экстренное включение администратором
**Предусловия:**
- Пользователи работают в системе.
- Администратор системы открыт в `/admin/settings/maintenance`.

**Шаги:**
1. Администратор включает режим «немедленно».

**Ожидаемый результат:**
- В течение 1 минуты пользователи получают статус «active».
- UI переходит на экран обслуживания.

---

## Блокировка входа

### СЦ‑05. Вход во время активного обслуживания
**Предусловия:**
- Режим обслуживания активен.

**Шаги:**
1. Пользователь открывает страницу входа.
2. Пытается авторизоваться.

**Ожидаемый результат:**
- Форма входа недоступна.
- Пользователь видит экран обслуживания с сообщением.

---

## Пользователь уже в системе

### СЦ‑06. Пользователь в активной сессии
**Предусловия:**
- Пользователь находится в чате.
- Режим обслуживания активируется.

**Шаги:**
1. Пользователь пытается отправить сообщение.

**Ожидаемый результат:**
- Запрос блокируется (503 + `errorCode=MAINTENANCE_MODE`).
- UI переходит к экрану обслуживания.

---

## Навигация между разделами

### СЦ‑07. Баннер сохраняется при переходах
**Предусловия:**
- Режим обслуживания запланирован, баннер активен.

**Шаги:**
1. Пользователь переходит между разделами (чат → навыки → база знаний).

**Ожидаемый результат:**
- Баннер не мигает и не исчезает.
- Состояние баннера сохраняется.

---

## Межвкладочная синхронизация

### СЦ‑08. Две вкладки одного пользователя
**Предусловия:**
- Пользователь открыл приложение в двух вкладках.

**Шаги:**
1. В первой вкладке режим обслуживания включается.
2. Пользователь переключается на вторую вкладку.

**Ожидаемый результат:**
- Вторая вкладка получает актуальный статус не позднее 60 секунд.
- Экран обслуживания отображается одинаково в обеих вкладках.

---

## Завершение обслуживания

### СЦ‑09. Автоматическое завершение
**Предусловия:**
- Плановый интервал завершился.
- Пользователь открыт в браузере.

**Шаги:**
1. Клиент получает обновлённый статус.

**Ожидаемый результат:**
- Экран обслуживания исчезает.
- Интерфейс возвращается к нормальному состоянию.
