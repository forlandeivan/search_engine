# Ручные тесткейсы: режим обслуживания

## Предусловия
- Есть пользователь с ролью администратора и пользователь без прав администратора.
- Администратор может входить в админку.
- Есть доступ к браузеру, где можно открыть несколько вкладок.
- При необходимости можно временно отключить запрос к `/api/maintenance/status` в DevTools или через прокси.

## Тестовые данные
- Интервал с началом больше чем через 24 часа.
- Интервал с началом примерно через 2 часа.
- Интервал с началом примерно через 30 минут.
- Интервал с началом примерно через 10 минут.
- Пустые значения для заголовка, описания и ETA.
- Заполненные значения для заголовка, описания и ETA.

## Глоссарий статусов и сообщений
- Запланирован — обслуживание в будущем.
- Активный — обслуживание идёт сейчас.
- Экстренный — обслуживание включено вручную.
- Архивный — обслуживание завершено.
- «Сервис временно недоступен» — экран при недоступном статусе.

## Тесткейсы

### MM-01. Запланировать обслуживание с валидными данными
Цель: убедиться, что расписание сохраняется и отображается в журнале.
Предусловия: администратор авторизован.
Шаги:
1. Открыть страницу режима обслуживания.
2. Выбрать часовой пояс.
3. Нажать «Запланировать».
4. Указать дату и время начала и окончания.
5. Заполнить заголовок, описание и ETA.
6. Нажать «Сохранить».
Ожидаемый результат: интервал появляется в журнале со статусом «Запланирован» и корректными деталями.
Примечания/варианты: повторить без заполнения текстовых полей.

### MM-02. Ошибка при окончании раньше начала
Цель: проверить валидацию интервала.
Предусловия: администратор авторизован.
Шаги:
1. Открыть «Запланировать».
2. Задать время окончания раньше начала.
3. Нажать «Сохранить».
Ожидаемый результат: отображается ошибка «Окончание должно быть позже начала», сохранение не происходит.
Примечания/варианты: проверить на одном и том же дне.

### MM-03. Ошибка при заполненной только дате или времени
Цель: проверить, что дата и время вводятся вместе.
Предусловия: администратор авторизован.
Шаги:
1. Указать только дату начала без времени.
2. Нажать «Сохранить».
Ожидаемый результат: отображается ошибка «Для начала укажите дату и время» или «Дата начала и окончания должны быть заполнены вместе».
Примечания/варианты: повторить для окончания.

### MM-04. Отображение интервала в выбранном часовом поясе
Цель: убедиться, что журнал показывает время в выбранном часовом поясе.
Предусловия: администратор авторизован, есть сохранённый интервал.
Шаги:
1. Выбрать часовой пояс с заметным смещением.
2. Открыть журнал интервалов.
Ожидаемый результат: время в колонке «Интервал» отображается в выбранном часовом поясе и заголовок колонки содержит нужный UTC‑офсет.
Примечания/варианты: сравнить с другим часовым поясом.

### MM-05. Баннер не показывается, если до начала больше 24 часов
Цель: проверить правило скрытия баннера.
Предусловия: создан интервал с началом больше чем через 24 часа.
Шаги:
1. Открыть любую страницу приложения как пользователь.
Ожидаемый результат: баннер о плановом обслуживании не отображается.
Примечания/варианты: обновить страницу.

### MM-06. Нейтральный баннер за ~2 часа до начала
Цель: проверить нейтральный стиль баннера.
Предусловия: создан интервал с началом примерно через 2 часа.
Шаги:
1. Открыть любую страницу приложения как пользователь.
Ожидаемый результат: баннер отображается, фон соответствует обычному фону страницы, текст обычного цвета.
Примечания/варианты: проверить наличие даты начала и окончания в баннере.

### MM-07. Жёлтый баннер за ~30 минут до начала
Цель: проверить жёлтый стиль баннера.
Предусловия: создан интервал с началом примерно через 30 минут.
Шаги:
1. Открыть любую страницу приложения как пользователь.
Ожидаемый результат: баннер жёлтый.
Примечания/варианты: убедиться, что отображаются заголовок и описание.

### MM-08. Красный баннер за ~10 минут до начала
Цель: проверить красный стиль баннера.
Предусловия: создан интервал с началом примерно через 10 минут.
Шаги:
1. Открыть любую страницу приложения как пользователь.
Ожидаемый результат: баннер красный.
Примечания/варианты: проверить, что баннер не дублируется.

### MM-09. Переход в экран недоступности в момент начала
Цель: убедиться, что экран недоступности включается при старте интервала.
Предусловия: создан интервал с началом через несколько минут.
Шаги:
1. Оставить страницу открытой до времени начала.
2. Дождаться начала.
Ожидаемый результат: не позднее чем через 1 минуту появляется экран недоступности, баннер исчезает.
Примечания/варианты: обновить страницу для мгновенного обновления статуса.

### MM-10. Завершение обслуживания по времени окончания
Цель: проверить автоматическое выключение.
Предусловия: активное обслуживание по расписанию.
Шаги:
1. Дождаться окончания интервала.
Ожидаемый результат: экран недоступности исчезает, система возвращается в нормальный режим.
Примечания/варианты: проверить обновлением страницы.

### MM-11. Досрочное завершение активного расписания
Цель: проверить кнопку «Отключить» для активного интервала.
Предусловия: активное обслуживание по расписанию, администратор на странице режима обслуживания.
Шаги:
1. В журнале нажать «Отключить» для активного интервала.
2. Подтвердить действие.
Ожидаемый результат: обслуживание завершается, статус записи становится «Архивный», экран недоступности исчезает.
Примечания/варианты: проверить в отдельной вкладке пользователя.

### MM-12. Отмена запланированного интервала
Цель: проверить кнопку «Отменить».
Предусловия: есть запланированный интервал.
Шаги:
1. В журнале нажать «Отменить».
2. Подтвердить действие.
Ожидаемый результат: интервал удаляется из журнала, баннер не показывается.
Примечания/варианты: проверить, что статус в системе «Выключен».

### MM-13. Экстренное включение
Цель: проверить немедленное включение.
Предусловия: администратор авторизован.
Шаги:
1. Нажать «Экстренно включить».
2. Заполнить сообщения при необходимости.
3. Подтвердить действие.
Ожидаемый результат: появляется экран недоступности у пользователей, в журнале появляется запись со статусом «Экстренный» и «Активный».
Примечания/варианты: проверить, что баннер не показывается.

### MM-14. Редактирование сообщений экстренного режима
Цель: проверить обновление текста без отключения режима.
Предусловия: активный экстренный режим.
Шаги:
1. В журнале нажать «Редактировать» для экстренного режима.
2. Изменить заголовок, описание и ETA.
3. Нажать «Сохранить».
Ожидаемый результат: режим остаётся активным, пользователи видят обновлённые тексты после обновления статуса.
Примечания/варианты: проверить в отдельной вкладке пользователя.

### MM-15. Отключение экстренного режима
Цель: проверить ручное выключение.
Предусловия: активный экстренный режим.
Шаги:
1. В журнале нажать «Отключить».
2. Подтвердить действие.
Ожидаемый результат: режим выключается, запись становится «Архивный», экран недоступности исчезает.
Примечания/варианты: проверить возврат в обычный интерфейс.

### MM-16. Поведение при обновлении страницы
Цель: проверить сохранение состояния при refresh.
Предусловия: есть запланированный или активный режим.
Шаги:
1. Открыть страницу приложения.
2. Обновить страницу.
Ожидаемый результат: баннер или экран недоступности отображаются корректно после обновления.
Примечания/варианты: повторить для статусов «Запланирован» и «Активный».

### MM-17. Поведение при открытии новой вкладки
Цель: проверить корректное состояние в новой вкладке.
Предусловия: есть запланированный или активный режим.
Шаги:
1. Открыть новую вкладку приложения.
Ожидаемый результат: новая вкладка сразу показывает актуальный баннер или экран недоступности.
Примечания/варианты: повторить для статусов «Запланирован» и «Активный».

### MM-18. Права доступа к настройкам
Цель: убедиться, что менять настройки может только администратор.
Предусловия: есть пользователь без прав администратора.
Шаги:
1. Открыть `/admin/settings/maintenance` под обычным пользователем.
Ожидаемый результат: доступ запрещён или показана страница «Нет доступа».
Примечания/варианты: администратор должен иметь доступ.

### MM-19. Недоступность источника статуса
Цель: проверить safe mode.
Предусловия: доступ к DevTools или прокси.
Шаги:
1. Заблокировать запрос к `/api/maintenance/status`.
2. Открыть приложение как пользователь.
Ожидаемый результат: показывается экран «Сервис временно недоступен» и текст с рекомендацией обновить страницу позже.
Примечания/варианты: снять блокировку и убедиться, что интерфейс восстановился.

### MM-20. Визуальная консистентность баннера
Цель: убедиться, что баннер не дублируется и не мигает.
Предусловия: статус «Запланирован» и до начала меньше 24 часов.
Шаги:
1. Перейти между несколькими разделами приложения.
2. Открыть страницу админки.
Ожидаемый результат: баннер один, расположен вверху, без дублирования и заметного мигания.
Примечания/варианты: проверить после обновления страницы.

## Регрессионный чеклист
- Баннер отображается только при запланированном обслуживании и только за 24 часа до начала.
- Градация цветов баннера соответствует времени до начала.
- Экран недоступности включается при активном режиме и исчезает после завершения.
- Администратор может управлять режимом только на странице настроек.
- Экстренный режим включается и выключается вручную без ошибок.
